{% extends "base.html" %}
{% from 'macros/form.html' import btn %}

{% block content %}
  <section class="user">
    <img class="user__avatar" src="{{ user.avatar(256) }}" width="256" alt="{{ _('User avatar') }}">
    <div class="user__description">
      <h1 class="main__title">{{ _('User') }}: {{ user.username }}</h1>

      {% if user.about_me %}<p class="user__text">{{ user.about_me }}</p>{% endif %}
      {% if user.last_seen %}<p class="user__text user__text--date">{{ _('Last seen on') }}: {{ moment(user.last_seen).format('LLL') }}</p>{% endif %}
      <p class="user__text">{{ _('%(count)d followers', count=user.followers.count()) }}, {{ _('%(count)d following', count=user.followed.count()) }}</p>

      <div class="user__btns">
        {% if user == current_user %}
          <a class="user__btn" href="{{ url_for('main.edit_profile') }}">{{ _('Edit your profile') }}</a>
        
          {% if not current_user.get_task_in_progress('export_posts') %}
            <a class="user__btn" href="{{ url_for('main.export_posts') }}">{{ _('Export your posts') }}</a>
          {% endif %}
        {% elif not current_user.is_following(user) %}
          <form class="form" action="{{ url_for('main.follow', username=user.username) }}" method="post">
            {{ form.hidden_tag() }}
            {{ btn(form.submit, value=_('Follow')) }}
          </form>
        {% else %}
          <form class="form" action="{{ url_for('main.unfollow', username=user.username) }}" method="post">
            {{ form.hidden_tag() }}
            {{ btn(form.submit, value=_('Unfollow')) }}
          </form>
        {% endif %}

        {% if user != current_user %}
          <a class="user__btn" href="{{ url_for('main.send_message', recipient=user.username) }}">
            {{ _('Send private message') }}
          </a>
        {% endif %}
      </div>
    </div>
  </section>

  {% for post in posts %}
    {% include '_post.html' %}
  {% endfor %}

  {% include '_pagination.html' %}
{% endblock %}
